\section{Declaraciones}

\begin{frame}[fragile]{Declaración}
\begin{itemize}
  \item Una \alert{declaración} es una sentencia que introduce un nombre
        para una entidad en un alcance y especifica su tipo.
\begin{lstlisting}
int x; // x es una variable entera
vector<string> v; // v es un vector de cadenas
double area(double l, double a); // area es una función
\end{lstlisting}
  \item Una declaración puede incluir un valor inicial.
\begin{lstlisting}
int x = 2.5;
int y { 3.0 };
vector<string> v { "Carlos", "Daniel" };
double area(double l, double a) { return l * a; }
\end{lstlisting}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Declaración y uso}
\begin{itemize}
  \item Antes de usar una entidad este debe haber sido declarada.
\lstinputlisting{07-alcance/decl/main1.cpp}
    \begin{itemize}
      \item 5 errores:
        \begin{itemize}
          \item \verb+cout no declarado en este ámbito+.
          \item \verb+x no declarado en este ámbito+.
          \item \verb+y no declarado en este ámbito+.
          \item \verb+area no declarado en este ámbito+.
          \item \verb+endl no declarado en este ámbito+.
        \end{itemize}
      \item \cppid{cout} y \cppid{endl} están \alert{declarados} en el archivo de 
            cabecera \cppid{<iostream>}, dentro del espacio de nombres \cppid{std}.
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Inclusión de cabecera estándar}
\lstinputlisting{07-alcance/decl/main2.cpp}
\begin{itemize}
  \item El archivo de cabecera \cppid{<iostream>} contiene todas las declaraciones
        de biblioteca para entrada/salida estándar.
    \begin{itemize}
      \item 3 errores:
        \begin{itemize}
          \item \verb+x no declarado en este ámbito+.
          \item \verb+y no declarado en este ámbito+.
          \item \verb+area no declarado en este ámbito+.
        \end{itemize}
    \end{itemize}
\end{itemize}
\end{frame}

\begin{frame}[fragile]{Declaraciones}
\lstinputlisting{07-alcance/decl/main3.cpp}
\begin{itemize}
  \item Cambios:
    \begin{itemize}
      \item Declaración de variables \cppid{x}, e \cppid{y}.
      \item Declaración de función \cppid{area()}.
    \end{itemize}
  \item 0 errores de compilación.
  \item 1 error de enlace:
\begin{lstlisting}[style=terminal]
undefined reference to `area(double, double)'
collect2: error: ld devolvió el estado de salida 1
\end{lstlisting}
\end{itemize}
\end{frame}

\section{Definiciones}

\begin{frame}[fragile]{Definición}
  \begin{itemize}
    \item Una \alert{definición} es una \emph{declaración} que especifica completamente una entidad.
      \begin{itemize}
        \item Toda definición es siempre una declaración.
        \item Toda declaración no tiene por qué ser una definición.
      \end{itemize}
  \end{itemize}
\begin{lstlisting}
double x = 1.5; // Definición
double y { 0.5 }; // Definición
double z; // Definición
extern double t; // Declaración

double area(double l, double a); // Declaración
double area(double, double); // Declaración
double area(double l, double a) { return l*a; } // Definición
\end{lstlisting}
\end{frame}

\begin{frame}[fragile]{Multiplicidad}
\begin{itemize}
  \item Una \alert{definición} reserva espacio de memoria para una variable o genera código
        para una función.
    \begin{itemize}
      \item Solamente puede definirse una entidad una vez.
    \end{itemize}
  \item Una \alert{declaración} (que no defina) simplemente referencia la existencia de una entidad
        para permitir su uso.
    \begin{itemize}
      \item La entidad debe definirse en alguna otra parte.
      \item Se puede declarar una entidad múltiples veces si mantiene el tipo.
    \end{itemize}
\end{itemize}
\begin{lstlisting}
extern double ancho; // Declaración
extern double ancho; // Declaración
double ancho; // Definición
extern int ancho; // Error: Tipo

double area(double, double); // Declaración
double area(double l, double a): { return l*a; } // Definición
double area(double, double); // Declaración
int area(double, double); // Error: Tipo de retorno
\end{lstlisting}
\end{frame}

\section{Archivos de cabecera}

\begin{frame}{Cabecera}
\begin{itemize}
  \item Un \alert{archivo de cabecera} contiene declaraciones que pueden usarse desde
        varias unidades de traducción.
    \begin{itemize}
      \item No contienen definiciones.
      \item Al incluirse se sustituye la inclusión por el contenido del archivo.
    \end{itemize}
\end{itemize}
\begin{tikzpicture}
\tikzset{
    archfuente/.style={rectangle,rounded corners,draw=black, top color=white, bottom color=blue!50,very thick, inner sep=0.5em, minimum size=0, text centered, font=\tiny},
    flecha/.style={->, >=latex', shorten >=1pt, thick},
    flechainc/.style={->, >=latex', shorten >=1pt, thick, draw=blue},
    etiqueta/.style={text centered, font=\tiny} 
}  
\node[archfuente] (iostream) {\cppid{iostream}};
\node[archfuente, below=1cm of iostream] (geomh) {\cppid{geom.h}};

\node[archfuente, right=1cm of iostream] (maincpp) {\cppid{main.cpp}};
\draw[flechainc] (maincpp) -- (iostream);
\draw[flechainc] (maincpp) -- (geomh);

\node[archfuente, below=1cm of maincpp] (geomcpp) {\cppid{geom.cpp}};
\draw[flechainc] (geomcpp) -- (geomh);

\node[archfuente,right=1cm of maincpp] (maino) {\cppid{main.o}};
\draw[flecha] (maincpp) -- (maino);

\node[archfuente,below=1cm of maino] (geomo) {\cppid{geom.o}};
\draw[flecha] (geomcpp) -- (geomo);

\node[archfuente,right=1cm of maino] (main) {\cppid{main}};
\draw[flecha] (maino) -- (main);
\draw[flecha] (geomo) -- (main);

\node[archfuente,above=1cm of main] (stdlib) {\cppid{libstdc++}};
\draw[flecha] (stdlib) -- (main);

\node[etiqueta,above right=0cm and 0.3cm of iostream] {\emph{include}};
\node[etiqueta,above right=0cm and 0.3cm of maincpp] {\emph{compilación}};
\node[etiqueta,above right=0cm and 0.3cm of maino] {\emph{enlace}};

\end{tikzpicture}
\end{frame}

\begin{frame}{Ejemplo}
\begin{block}{geom.h}
\lstinputlisting{07-alcance/cab/geom.h}
\end{block}
\begin{block}{geom.cpp}
\lstinputlisting{07-alcance/cab/geom.cpp}
\end{block}
\end{frame}

\begin{frame}
\begin{block}{main.cpp}
\lstinputlisting{07-alcance/cab/main.cpp}
\end{block}
\end{frame}
